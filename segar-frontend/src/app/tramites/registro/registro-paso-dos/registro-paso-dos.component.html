<div class="slide-container">
  <div class="slide-header">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-2xl font-bold">Proceso de Trámites Regulatorios - INVIMA</h1>
        <p class="text-sm opacity-80 mt-1">Guía para empresas de alimentos procesados</p>
      </div>
      <div class="flex items-center">
        <span class="text-xl font-semibold">Sistema de Gestión de Trámites</span>
      </div>
    </div>
  </div>

  <div class="slide-content max-w-4xl mx-auto">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">Paso 2: Registro en Plataforma INVIMA</h2>

    <nav class="tabs" role="tablist">
      <button
        class="tab"
        [ngClass]="{'tab-active': activeTab === 'registro'}"
        (click)="setActiveTab('registro')"
        [attr.aria-selected]="activeTab === 'registro'"
        role="tab">
        Registro de Usuario
      </button>
      <button
        class="tab"
        [ngClass]="{'tab-active': activeTab === 'tarifas'}"
        (click)="setActiveTab('tarifas')"
        [attr.aria-selected]="activeTab === 'tarifas'"
        role="tab">
        Consulta de Tarifas
      </button>
      <button
        class="tab"
        [ngClass]="{'tab-active': activeTab === 'documentos'}"
        (click)="setActiveTab('documentos')"
        [attr.aria-selected]="activeTab === 'documentos'"
        role="tab">
        Preparación de Documentos
      </button>
      <button
        class="tab"
        [ngClass]="{'tab-active': activeTab === 'verificacion'}"
        (click)="setActiveTab('verificacion')"
        [attr.aria-selected]="activeTab === 'verificacion'"
        role="tab">
        Verificación
      </button>
    </nav>

    <!-- REGISTRO DE USUARIO -->
    <div class="tab-content" *ngIf="activeTab === 'registro'" role="tabpanel">
      <div class="section-card">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">Registro en la Plataforma INVIMA</h3>

        <!-- Paso 1 -->
        <section class="mb-6">
          <div class="flex items-center mb-2">
            <span class="text-lg font-bold text-blue-600 mr-2" aria-hidden="true">1</span>
            <h4 class="text-lg font-semibold text-gray-800">Acceda al sitio web oficial del INVIMA</h4>
          </div>
          <p class="text-gray-700 mb-2">
            Visite <a href="https://www.invima.gov.co" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">www.invima.gov.co</a> y busque la sección "Trámites y Servicios".
          </p>
          <div class="bg-gray-50 border border-gray-200 rounded p-3 text-sm text-gray-600">
            <strong class="block mb-1">INVIMA - Instituto Nacional de Vigilancia de Medicamentos y Alimentos</strong>
            <p>Inicio • Institucional • Trámites y Servicios • Normatividad • Sala de Prensa • Buscar...</p>
            <p class="mt-1">Trámites y Servicios • Registros Sanitarios • Consultas y Verificación</p>
          </div>
        </section>

        <!-- Paso 2 -->
        <section class="mb-6">
          <div class="flex items-center mb-2">
            <span class="text-lg font-bold text-blue-600 mr-2" aria-hidden="true">2</span>
            <h4 class="text-lg font-semibold text-gray-800">Cree una cuenta en el sistema</h4>
          </div>
          <p class="text-gray-700 mb-2">
            Busque la opción "Registrarse" o "Crear cuenta" y complete el formulario con la información de su empresa.
          </p>
          <p class="text-gray-700 mb-2 font-medium">Información requerida para el registro:</p>
          <ul class="list-disc pl-6 space-y-1 text-gray-700 mb-4">
            <li>NIT de la empresa y razón social</li>
            <li>Datos del representante legal</li>
            <li>Dirección de la empresa y datos de contacto</li>
            <li>Correo electrónico corporativo</li>
          </ul>

          <form class="grid grid-cols-1 md:grid-cols-2 gap-4" (ngSubmit)="onSubmitRegistro()" #registroFormRef="ngForm">
            <div>
              <label for="persona" class="form-label">Tipo de Persona</label>
              <select
                id="persona"
                [(ngModel)]="registroForm.persona"
                name="persona"
                class="form-input"
                required>
                <option value="Jurídica">Jurídica</option>
                <option value="Natural">Natural</option>
              </select>
            </div>
            <div>
              <label for="tipoDocumento" class="form-label">Tipo de Documento</label>
              <select
                id="tipoDocumento"
                [(ngModel)]="registroForm.tipoDocumento"
                name="tipoDocumento"
                class="form-input"
                required>
                <option value="NIT">NIT</option>
                <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>
              </select>
            </div>
            <div>
              <label for="numeroDocumento" class="form-label">Número de Documento</label>
              <input
                type="text"
                id="numeroDocumento"
                [(ngModel)]="registroForm.numeroDocumento"
                name="numeroDocumento"
                class="form-input"
                required>
            </div>
            <div>
              <label for="razonSocial" class="form-label">Razón Social</label>
              <input
                type="text"
                id="razonSocial"
                [(ngModel)]="registroForm.razonSocial"
                name="razonSocial"
                class="form-input"
                required>
            </div>
            <div class="col-span-2">
              <label for="correo" class="form-label">Correo Electrónico</label>
              <input
                type="email"
                id="correo"
                [(ngModel)]="registroForm.correo"
                name="correo"
                class="form-input"
                required>
            </div>
            <div>
              <label for="password" class="form-label">Contraseña</label>
              <input
                type="password"
                id="password"
                [(ngModel)]="registroForm.password"
                name="password"
                class="form-input"
                minlength="8"
                required>
            </div>
            <div>
              <label for="confirmPassword" class="form-label">Confirmar Contraseña</label>
              <input
                type="password"
                id="confirmPassword"
                [(ngModel)]="registroForm.confirmPassword"
                name="confirmPassword"
                class="form-input"
                required>
            </div>
            <div class="col-span-2 text-center mt-4">
              <button
                type="submit"
                class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50"
                [disabled]="!registroFormRef.form.valid">
                Registrarse
              </button>
            </div>
          </form>
        </section>

        <!-- Paso 3 -->
        <section class="mb-6">
          <div class="flex items-center mb-2">
            <span class="text-lg font-bold text-blue-600 mr-2" aria-hidden="true">3</span>
            <h4 class="text-lg font-semibold text-gray-800">Verifique su correo electrónico</h4>
          </div>
          <p class="text-gray-700">
            El INVIMA enviará un correo de verificación para activar su cuenta. Siga las instrucciones del correo para completar el proceso.
          </p>
          <p class="text-yellow-700 italic mt-1">
            Importante: Revise su carpeta de spam si no encuentra el correo de verificación en su bandeja de entrada.
          </p>
        </section>

        <!-- Paso 4 -->
        <section class="mb-6">
          <div class="flex items-center mb-2">
            <span class="text-lg font-bold text-blue-600 mr-2" aria-hidden="true">4</span>
            <h4 class="text-lg font-semibold text-gray-800">Inicie sesión en el sistema</h4>
          </div>
          <p class="text-gray-700">
            Una vez activada su cuenta, inicie sesión con sus credenciales para acceder a los servicios de trámites en línea.
          </p>
          <p class="text-green-700 italic mt-1">
            Consejo: Guarde sus credenciales en un lugar seguro y no las comparta con personas no autorizadas.
          </p>
        </section>

        <!-- Próximos pasos -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-100">
          <h4 class="text-lg font-semibold text-gray-800 mb-2">Próximos Pasos</h4>
          <ul class="list-disc pl-6 space-y-1 text-gray-700">
            <li>Radicación de la solicitud: Presentar formalmente la solicitud con toda la documentación requerida.</li>
            <li>Seguimiento del trámite: Monitorear el estado de la solicitud a través de la plataforma del INVIMA.</li>
            <li>Respuesta a requerimientos: Atender oportunamente cualquier solicitud de información adicional.</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- CONSULTA DE TARIFAS -->
    <div class="tab-content" *ngIf="activeTab === 'tarifas'" role="tabpanel">
      <div class="section-card">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">Consulta de Tarifas INVIMA</h3>

        <p class="text-gray-700 mb-4">¿Cómo consultar las tarifas vigentes? Siga estos pasos:</p>

        <ol class="list-decimal pl-6 space-y-2 text-gray-700 mb-6">
          <li>Visite el sitio web oficial del INVIMA: <a href="https://www.invima.gov.co" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">www.invima.gov.co</a></li>
          <li>Busque la sección "Trámites y Servicios" o "Tarifas"</li>
          <li>Descargue el manual tarifario vigente (actualizado anualmente)</li>
          <li>Identifique el código del trámite que necesita realizar</li>
        </ol>

        <h4 class="text-lg font-semibold text-gray-800 mb-2">Tarifas comunes para alimentos procesados (2023)</h4>

        <div class="overflow-x-auto mb-4">
          <table class="min-w-full bg-white border border-gray-300 text-sm text-gray-700">
            <thead class="bg-blue-100">
            <tr>
              <th scope="col" class="px-4 py-2 border border-gray-300 text-left">Código</th>
              <th scope="col" class="px-4 py-2 border border-gray-300 text-left">Descripción del Trámite</th>
              <th scope="col" class="px-4 py-2 border border-gray-300 text-left">Valor (COP)</th>
            </tr>
            </thead>
            <tbody>
            <tr
              *ngFor="let tarifa of tarifas; trackBy: trackByTarifa"
              class="hover:bg-gray-50">
              <td class="px-4 py-2 border border-gray-300">{{ tarifa.codigo }}</td>
              <td class="px-4 py-2 border border-gray-300">{{ tarifa.descripcion }}</td>
              <td class="px-4 py-2 border border-gray-300">{{ tarifa.valor }}</td>
            </tr>
            </tbody>
          </table>
        </div>

        <p class="text-sm text-gray-600 italic mb-6">
          * Los valores son aproximados y pueden variar. Consulte siempre el manual tarifario vigente.
        </p>

        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded mb-6 text-sm text-yellow-800">
          <p><strong>Recuerde:</strong> El pago de la tarifa es requisito indispensable para iniciar cualquier trámite. Conserve el comprobante de pago para adjuntarlo a su solicitud.</p>
        </div>

        <!-- PRÓXIMOS PASOS -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-100">
          <h4 class="text-lg font-semibold text-gray-800 mb-2">Próximos Pasos</h4>
          <ul class="list-disc pl-6 space-y-1 text-gray-700">
            <li>Radicación de la solicitud: Presentar formalmente la solicitud con toda la documentación requerida.</li>
            <li>Seguimiento del trámite: Monitorear el estado de la solicitud a través de la plataforma del INVIMA.</li>
            <li>Respuesta a requerimientos: Atender oportunamente cualquier solicitud de información adicional.</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- PREPARACIÓN DE DOCUMENTOS -->
    <div class="tab-content" *ngIf="activeTab === 'documentos'" role="tabpanel">
      <div class="section-card">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">Preparación de Documentos</h3>
        <p class="text-gray-700 mb-4">Complete cuidadosamente la información para generar la ficha técnica de su producto.</p>

        <form (ngSubmit)="onSaveDocument()" #documentForm="ngForm">
          <div class="form-section">
            <label for="productName" class="form-label">Nombre del producto</label>
            <input
              id="productName"
              [(ngModel)]="dynamicDocument.productName"
              name="productName"
              class="form-input"
              type="text"
              required>

            <label for="brand" class="form-label mt-3">Marca comercial</label>
            <input
              id="brand"
              [(ngModel)]="dynamicDocument.brand"
              name="brand"
              class="form-input"
              type="text"
              required>

            <label for="presentation" class="form-label mt-3">Presentación comercial</label>
            <input
              id="presentation"
              [(ngModel)]="dynamicDocument.presentation"
              name="presentation"
              class="form-input"
              type="text"
              required>

            <label for="shelfLife" class="form-label mt-3">Vida útil estimada (meses)</label>
            <input
              id="shelfLife"
              [(ngModel)]="dynamicDocument.shelfLife"
              name="shelfLife"
              class="form-input"
              type="number"
              min="1"
              required>
          </div>

          <div class="form-section">
            <label for="description" class="form-label">Descripción del Producto</label>
            <textarea
              id="description"
              [(ngModel)]="dynamicDocument.description"
              name="description"
              class="form-textarea"
              required></textarea>
          </div>

          <div class="form-section">
            <label for="ingredients" class="form-label">Ingredientes</label>
            <textarea
              id="ingredients"
              [(ngModel)]="dynamicDocument.ingredients"
              name="ingredients"
              class="form-textarea"
              required></textarea>
          </div>

          <div class="form-section">
            <label class="form-label">Aditivos Alimentarios</label>
            <div
              *ngFor="let aditivo of dynamicDocument.additives; let i = index; trackBy: trackByAdditive"
              class="flex space-x-2 mb-2">
              <input
                [(ngModel)]="aditivo.name"
                [name]="'additive_name_' + i"
                placeholder="Nombre"
                class="form-input">
              <input
                [(ngModel)]="aditivo.code"
                [name]="'additive_code_' + i"
                placeholder="Código INS"
                class="form-input">
              <input
                [(ngModel)]="aditivo.function"
                [name]="'additive_function_' + i"
                placeholder="Función"
                class="form-input">
              <button
                type="button"
                (click)="removeAdditive(i)"
                class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600"
                [attr.aria-label]="'Eliminar aditivo ' + (i + 1)">
                ✕
              </button>
            </div>
            <button
              type="button"
              (click)="addAdditive()"
              class="mt-2 text-sm text-blue-600 hover:underline">
              Añadir aditivo
            </button>
          </div>

          <div class="text-center mt-6">
            <button
              type="submit"
              class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 disabled:opacity-50"
              [disabled]="!documentForm.form.valid">
              Guardar Ficha Técnica
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- VERIFICACIÓN -->
    <div class="tab-content" *ngIf="activeTab === 'verificacion'" role="tabpanel">
      <div class="section-card">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Verificación de Registro INVIMA</h3>
        <p class="text-gray-700 mb-4">
          Para continuar con el proceso, necesitamos verificar que ha completado correctamente el registro en la plataforma INVIMA. Por favor, adjunte el correo de confirmación que recibió del INVIMA después de activar su cuenta.
        </p>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 text-sm text-blue-700">
          Importante: La verificación de este paso es necesaria para continuar con el proceso de trámite. Si tiene problemas para encontrar el correo de confirmación, puede contactar al soporte técnico del INVIMA.
        </div>

        <div class="verification-box mb-6 p-6 rounded-lg border-2 border-dashed border-blue-500 bg-blue-50">
          <div *ngIf="!uploading && !success" class="text-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-blue-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
            <h4 class="text-lg font-medium text-gray-800 mb-2">Adjunte el correo de confirmación del INVIMA</h4>
            <p class="text-gray-600 mb-4">Formatos aceptados: PDF, JPG, PNG (máx. 5MB)</p>

            <input
              type="file"
              (change)="onFileSelected($event)"
              class="hidden"
              #fileInput
              accept=".pdf,.jpg,.jpeg,.png">
            <button
              (click)="fileInput.click()"
              class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
              Seleccionar archivo
            </button>
          </div>

          <div *ngIf="uploading" class="mt-4 text-center">
            <p class="text-lg font-medium text-gray-800 mb-2">Subiendo archivo...</p>
            <div class="progress-bar mt-2">
              <div
                class="progress-fill"
                [style.width.%]="uploadProgress"
                [attr.aria-valuenow]="uploadProgress"
                aria-valuemin="0"
                aria-valuemax="100"
                role="progressbar"></div>
            </div>
          </div>

          <div *ngIf="success" class="mt-4 text-center">
            <div class="checkmark-circle show mx-auto mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
              </svg>
            </div>
            <h4 class="text-lg font-medium text-green-700 mb-2">¡Verificación completada!</h4>
            <p class="text-gray-600 mb-4">El correo de confirmación ha sido verificado correctamente.</p>

            <button class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">Continuar al siguiente paso</button>
          </div>

          <div *ngIf="alternativeVerification" class="mt-4 text-center text-yellow-700">
            <p class="mb-2">Adjunte una captura de pantalla de su panel de usuario en el INVIMA para verificar su cuenta.</p>
          </div>

          <div class="mt-4 text-center">
            <button
              (click)="triggerAlternativeVerification()"
              class="text-blue-600 hover:underline text-sm">
              ¿No tiene el correo de confirmación? Verificar mediante captura de pantalla del panel de usuario
            </button>
          </div>
        </div>

        <div class="step-card bg-white p-6 border border-gray-200 mb-6">
          <div class="flex items-center mb-4">
            <div class="bg-blue-100 rounded-full p-3 mr-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <h4 class="text-lg font-medium text-gray-800">¿Cómo encontrar el correo de confirmación?</h4>
          </div>

          <ol class="space-y-3 text-gray-600">
            <li class="flex items-start">
              <span class="bg-blue-100 text-blue-600 rounded-full w-6 h-6 flex items-center justify-center font-semibold mr-2" aria-hidden="true">1</span>
              <div>Revise su bandeja de entrada con el asunto "Confirmación de registro - INVIMA"</div>
            </li>
            <li class="flex items-start">
              <span class="bg-blue-100 text-blue-600 rounded-full w-6 h-6 flex items-center justify-center font-semibold mr-2" aria-hidden="true">2</span>
              <div>Verifique las carpetas de spam o correo no deseado</div>
            </li>
            <li class="flex items-start">
              <span class="bg-blue-100 text-blue-600 rounded-full w-6 h-6 flex items-center justify-center font-semibold mr-2" aria-hidden="true">3</span>
              <div>Busque correos del remitente "notificaciones&#64;invima.gov.co"</div>
            </li>
            <li class="flex items-start">
              <span class="bg-blue-100 text-blue-600 rounded-full w-6 h-6 flex items-center justify-center font-semibold mr-2" aria-hidden="true">4</span>
              <div>Si no lo encuentra, puede adjuntar una captura de pantalla de su panel de usuario en la plataforma INVIMA que muestre su cuenta activa</div>
            </li>
          </ol>
        </div>

        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-100">
          <h4 class="text-lg font-semibold text-gray-800 mb-2">Próximos Pasos</h4>
          <ul class="list-disc pl-6 space-y-1 text-gray-700">
            <li>Radicación de la solicitud: Presentar formalmente la solicitud con toda la documentación requerida.</li>
            <li>Seguimiento del trámite: Monitorear el estado de la solicitud a través de la plataforma del INVIMA.</li>
            <li>Respuesta a requerimientos: Atender oportunamente cualquier solicitud de información adicional.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="step-navigation">
    <div class="step-indicator">
      Paso <span class="current-step">2</span> de 5
    </div>
    <div class="flex gap-3">
      <a routerLink="/main/nuevo/registro/paso-1" class="nav-btn nav-btn-secondary">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Anterior
      </a>
      <a routerLink="/main/nuevo/registro/paso-3" class="nav-btn nav-btn-primary">
        Siguiente
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>
    </div>
  </div>

  <footer class="slide-footer">
    <span class="text-sm text-gray-500">© 2024 Sistema de Gestión de Trámites INVIMA</span>
    <div class="flex space-x-4">
      <button class="text-sm text-blue-600 hover:text-blue-800">Descargar como PDF</button>
      <button class="text-sm text-blue-600 hover:text-blue-800">Compartir</button>
    </div>
  </footer>
</div>
